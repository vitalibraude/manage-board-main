<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro - ניהול פרויקטים מתקדם</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-tasks"></i>
                    <h1>TaskFlow Pro</h1>
                </div>
                <div class="header-actions">
                    <button id="toggleView" class="btn btn-secondary">
                        <i class="fas fa-exchange-alt"></i>
                        <span id="viewLabel">מבט לפי מתכנת</span>
                    </button>
                    <button id="addTaskBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        משימה חדשה
                    </button>
                    <button id="dashboardBtn" class="btn btn-info">
                        <i class="fas fa-chart-pie"></i>
                        דאשבורד
                    </button>
                </div>
            </div>
        </header>

        <!-- Contacts Directory -->
        <div class="contacts-directory" id="contactsDirectory">
            <div class="contacts-header">
                <h3><i class="fas fa-address-book"></i> אנשי קשר מרכזיים</h3>
                <button class="btn-close" onclick="toggleContacts()">×</button>
            </div>
            <div class="contacts-grid" id="contactsGrid"></div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- View by Project -->
            <div id="projectView" class="view-container active">
                <div class="projects-grid" id="projectsGrid"></div>
            </div>

            <!-- View by Developer -->
            <div id="developerView" class="view-container">
                <div class="developers-grid" id="developersGrid"></div>
            </div>
        </main>

        <!-- Dashboard Modal -->
        <div id="dashboardModal" class="modal">
            <div class="modal-content dashboard-modal">
                <div class="modal-header">
                    <h2><i class="fas fa-chart-line"></i> דאשבורד אנליטי</h2>
                    <button class="close-btn" onclick="closeDashboard()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-clipboard-list"></i>
                            <h3 id="totalTasks">0</h3>
                            <p>סה"כ משימות</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-check-circle"></i>
                            <h3 id="completedTasks">0</h3>
                            <p>הושלמו</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-spinner"></i>
                            <h3 id="inProgressTasks">0</h3>
                            <p>בתהליך</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-clock"></i>
                            <h3 id="pendingTasks">0</h3>
                            <p>ממתינות</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle"><i class="fas fa-plus-circle"></i> משימה חדשה</h2>
                    <button class="close-btn" onclick="closeTaskModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="taskForm">
                        <input type="hidden" id="taskId">
                        
                        <div class="form-group">
                            <label for="taskTitle"><i class="fas fa-heading"></i> כותרת המשימה</label>
                            <input type="text" id="taskTitle" required placeholder="הזן כותרת...">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="taskProject"><i class="fas fa-folder"></i> פרויקט</label>
                                <select id="taskProject" required>
                                    <option value="">בחר פרויקט...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="taskDeveloper"><i class="fas fa-user-tie"></i> מתכנת</label>
                                <select id="taskDeveloper" required>
                                    <option value="">בחר מתכנת...</option>
                                    <option value="ולאד">ולאד</option>
                                    <option value="זאק">זאק</option>
                                    <option value="סרגי">סרגי</option>
                                    <option value="ניקולה">ניקולה (אלכס)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="taskContact"><i class="fas fa-user"></i> איש קשר</label>
                                <select id="taskContact" required>
                                    <option value="">בחר איש קשר...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="taskStatus"><i class="fas fa-tasks"></i> סטטוס</label>
                                <select id="taskStatus" required>
                                    <option value="אפיין">📝 אפיין</option>
                                    <option value="החלנו אפיון">🚀 החלנו אפיון</option>
                                    <option value="סיימנו אפיון">✅ סיימנו אפיון</option>
                                    <option value="נשלח אפיון ללקוח">📤 נשלח אפיון ללקוח</option>
                                    <option value="הלקוח נתן תיקונים לאפיון">🔄 הלקוח נתן תיקונים לאפיון</option>
                                    <option value="הלקוח אישר אפיון">👍 הלקוח אישר אפיון</option>
                                    <option value="אצל המתכנת">👨‍💻 אצל המתכנת</option>
                                    <option value="המתכנת סיים">✔️ המתכנת סיים</option>
                                    <option value="QA: הQA נתן הערות">🔍 QA: הQA נתן הערות</option>
                                    <option value="QA: אישר">✅ QA: אישר</option>
                                    <option value="הלקוח ראה פיתוח והוסיף הערות">💬 הלקוח ראה פיתוח והוסיף הערות</option>
                                    <option value="הלקוח אישר">🎉 הלקוח אישר</option>
                                    <option value="משימה גמורה">🏆 משימה גמורה</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="taskDescription"><i class="fas fa-align-left"></i> תיאור</label>
                            <textarea id="taskDescription" rows="4" placeholder="תיאור המשימה..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="taskNote"><i class="fas fa-comment"></i> הערה חדשה</label>
                            <textarea id="taskNote" rows="2" placeholder="הוסף הערה..."></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> שמור
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">
                                <i class="fas fa-times"></i> ביטול
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Task Details Modal -->
        <div id="taskDetailsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="detailsTitle"></h2>
                    <button class="close-btn" onclick="closeDetailsModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="taskDetailsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
    <script src="load_tasks.js"></script>
    <script src="app.js"></script>
</body>
</html>
